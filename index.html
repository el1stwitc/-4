<!DOCTYPE html>

<html lang="ru">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Resell Pro Database Edition</title>

    

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="apple-touch-icon" href="icon.png">

    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    

    <style>

        :root {

            --primary-grad: linear-gradient(135deg, #da22ff 0%, #9733ee 100%);

            --bg-color: #f4f7f6;

            --danger: #ff4b5c;

            --success: #2ecc71;

            --gold: #d4af37;

        }



        body {

            margin: 0; padding: 0;

            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            background-color: #222;

            display: flex; justify-content: center;

            height: 100vh; overflow: hidden;

        }



        #app-container {

            width: 100%; max-width: 414px;

            height: 100%; background-color: var(--bg-color);

            position: relative; display: flex; flex-direction: column;

            overflow: hidden;

        }



        header {

            background: var(--primary-grad); color: white;

            padding: 25px 20px 15px; text-align: center;

            font-size: 1.2rem; font-weight: bold; z-index: 10;

        }



        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }



        .tab-content { display: none; }

        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }



        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }



        nav {

            position: absolute; bottom: 0; width: 100%; height: 85px;

            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);

            display: flex; justify-content: space-around;

            align-items: center; border-top: 1px solid #eee; z-index: 20;

            padding-bottom: 15px;

        }



        nav button {

            background: none; border: none; color: #aaa;

            font-size: 0.7rem; display: flex; flex-direction: column; align-items: center;

            cursor: pointer;

        }

        nav button.active { color: #9733ee; }

        nav button i { font-size: 1.4rem; margin-bottom: 4px; }



        .form-group { margin-bottom: 12px; position: relative; }

        label { display: block; margin-bottom: 4px; font-weight: 500; color: #555; font-size: 0.85rem; }

        input, select, textarea {

            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px;

            box-sizing: border-box; font-size: 1rem; outline: none; background: white;

            -webkit-appearance: none; font-family: inherit;

        }



        .btn-primary {

            width: 100%; padding: 16px; background: var(--primary-grad);

            color: white; border: none; border-radius: 12px;

            font-size: 1rem; font-weight: bold; cursor: pointer;

            box-shadow: 0 4px 15px rgba(151, 51, 238, 0.3);

        }



        .card {

            background: white; padding: 15px; border-radius: 16px;

            margin-bottom: 12px; display: flex; gap: 15px; position: relative;

            box-shadow: 0 4px 10px rgba(0,0,0,0.03);

            cursor: pointer;

        }

        .card::before { content: ''; position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; border-radius: 0 4px 4px 0; }

        .card.active::before { background: #9733ee; }

        .card.sold::before { background: var(--success); }



        .card-img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; background: #eee; }

        .card-info { flex: 1; }



        #details-modal {

            position: fixed; top: 0; left: 0; width: 100%; height: 100%;

            background: rgba(0,0,0,0.8); display: none; justify-content: center;

            align-items: center; z-index: 100; backdrop-filter: blur(5px);

        }

        .modal-content {

            background: white; width: 90%; max-width: 380px; border-radius: 24px;

            padding: 20px; position: relative; max-height: 85vh; overflow-y: auto;

        }

        

        .photo-gallery { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; scroll-snap-type: x mandatory; }

        .photo-gallery img { width: 100%; height: 250px; flex-shrink: 0; border-radius: 16px; object-fit: cover; scroll-snap-align: start; }



        .photo-upload {

            width: 100%; height: 80px; border: 2px dashed #ddd; border-radius: 12px;

            display: flex; flex-direction: column; align-items: center; justify-content: center; 

            font-size: 0.8rem; color: #aaa; cursor: pointer;

        }

        

        .photo-preview-container { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }

        .mini-preview { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }



        .filter-row { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding: 5px 0; }

        .filter-btn { padding: 8px 18px; border-radius: 20px; border: none; background: #eee; font-size: 0.85rem; cursor: pointer; white-space: nowrap; }

        .filter-btn.active { background: var(--primary-grad); color: white; }



        .stat-card { background: white; padding: 15px; border-radius: 16px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }

        .stat-val { font-weight: bold; font-size: 1.2rem; }

        

        .data-actions { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }

        .btn-outline { background: white; border: 1px solid #ddd; padding: 12px; border-radius: 12px; font-size: 0.9rem; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }

    </style>

</head>

<body>



<div id="datalist-container"></div>



<div id="details-modal" onclick="closeModal()">

    <div class="modal-content" onclick="event.stopPropagation()">

        <div id="m-gallery" class="photo-gallery"></div>

        <h2 id="m-title" style="margin:0 0 15px 0; font-size:1.3rem;"></h2>

        <div id="m-details"></div>

        <button class="btn-primary" style="margin-top:15px;" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>

        <button id="btn-delete-item" style="width:100%; background:none; border:none; color:var(--danger); margin-top:15px; font-weight:bold;">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

    </div>

</div>



<div id="app-container">

    <header id="header-title">–ù–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</header>



    <main>

        <div id="tab-add" class="tab-content active">

            <div class="form-group">

                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>

                <select id="add-type" onchange="updateDatalists(); renderAddForm();">

                    <option value="phone">üì± –°–º–∞—Ä—Ç—Ñ–æ–Ω</option>

                    <option value="headphones">üéß –ù–∞—É—à–Ω–∏–∫–∏</option>

                    <option value="watch">‚åö –ß–∞—Å—ã</option>

                </select>

            </div>



            <div class="form-group">

                <div class="photo-upload" onclick="document.getElementById('inp-photo').click()">

                    <i class="fa-solid fa-camera"></i>

                    <span>–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</span>

                </div>

                <input type="file" id="inp-photo" accept="image/*" multiple style="display:none" onchange="handlePhotos(this)">

                <div id="photo-preview-list" class="photo-preview-container"></div>

            </div>



            <div id="dynamic-form"></div>



            <div style="display:flex; gap:12px;">

                <div class="form-group" style="flex:1"><label>–ü–æ–∫—É–ø–∫–∞</label><input type="number" id="inp-buy" placeholder="0"></div>

                <div class="form-group" style="flex:1"><label>–†–µ–º–æ–Ω—Ç</label><input type="number" id="inp-repair" value="0"></div>

            </div>



            <div class="form-group">

                <label>–ó–∞–º–µ—Ç–∫–∏ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ–º–ø–ª–µ–∫—Ç)</label>

                <textarea id="inp-comment" rows="2"></textarea>

            </div>

            <button class="btn-primary" onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑—É</button>

        </div>



        <div id="tab-sell" class="tab-content">

            <div class="form-group"><label>–ü–æ–∏—Å–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ</label><input type="text" id="sell-search" placeholder="–ú–æ–¥–µ–ª—å –∏–ª–∏ IMEI..." oninput="renderSellList()"></div>

            <div class="form-group"><label>–¢–æ–≤–∞—Ä</label><select id="sell-select"></select></div>

            <div class="form-group"><label>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</label><input type="number" id="sell-price" placeholder="‚ÇΩ"></div>

            <button class="btn-primary" onclick="completeSell()">–ü—Ä–æ–¥–∞–Ω–æ</button>

        </div>



        <div id="tab-base" class="tab-content">

            <div class="filter-row">

                <button class="filter-btn active" onclick="renderBase('phone', this)">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã</button>

                <button class="filter-btn" onclick="renderBase('headphones', this)">–ù–∞—É—à–Ω–∏–∫–∏</button>

                <button class="filter-btn" onclick="renderBase('watch', this)">–ß–∞—Å—ã</button>

            </div>

            <div id="base-list"></div>

        </div>



        <div id="tab-stats" class="tab-content">

            <div style="background:white; border-radius:16px; padding:15px; height:180px; margin-bottom:15px;"><canvas id="statChart"></canvas></div>

            <div class="stat-card"><span>–ü—Ä–∏–±—ã–ª—å:</span><span id="stat-profit" class="stat-val">0 ‚ÇΩ</span></div>

            <div class="stat-card"><span>ROI:</span><span id="stat-roi" class="stat-val">0%</span></div>

            <div class="stat-card"><span>–°–¥–µ–ª–æ–∫:</span><span id="stat-count" class="stat-val">0</span></div>

            

            <div class="data-actions">

                <button class="btn-outline" onclick="downloadBackup()">

                    <i class="fa-solid fa-file-export"></i> –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã (JSON)

                </button>

                <button class="btn-outline" onclick="document.getElementById('import-file').click()">

                    <i class="fa-solid fa-file-import"></i> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

                </button>

                <input type="file" id="import-file" style="display:none" accept=".json" onchange="importBackup(this)">

            </div>

        </div>



        <div id="tab-history" class="tab-content"><div id="history-list"></div></div>

    </main>



    <nav>

        <button class="active" onclick="showTab('add', this)"><i class="fa-solid fa-plus-circle"></i>–í–≤–æ–¥</button>

        <button onclick="showTab('sell', this)"><i class="fa-solid fa-cash-register"></i>–ü—Ä–æ–¥–∞—Ç—å</button>

        <button onclick="showTab('base', this)"><i class="fa-solid fa-boxes-stacked"></i>–ë–∞–∑–∞</button>

        <button onclick="showTab('stats', this)"><i class="fa-solid fa-chart-line"></i>–°—Ç–∞—Ç.</button>

        <button onclick="showTab('history', this)"><i class="fa-solid fa-list-ul"></i>–õ–æ–≥</button>

    </nav>

</div>



<script>

    const GLOBAL_DATABASE = {

        brands: ["Apple", "Samsung", "Xiaomi", "Google", "Huawei", "Honor", "Sony", "Realme", "OnePlus", "Nothing"],

        models: {

            phone: [

                "iPhone 16 Pro Max", "iPhone 16 Pro", "iPhone 16 Plus", "iPhone 16",

                "iPhone 15 Pro Max", "iPhone 15 Pro", "iPhone 15 Plus", "iPhone 15",

                "iPhone 14 Pro Max", "iPhone 14 Pro", "iPhone 14", "iPhone 13 Pro Max", 

                "iPhone 13", "iPhone 13 mini", "iPhone 12 Pro", "iPhone 12", "iPhone 11",

                "Galaxy S24 Ultra", "Galaxy S24+", "Galaxy S24", "Galaxy S23 Ultra", "Galaxy S22 Ultra",

                "Redmi Note 13 Pro", "Poco F6 Pro", "Poco X6 Pro", "Xiaomi 14 Ultra"

            ],

            headphones: [

                "AirPods Pro 2", "AirPods 4 (ANC)", "AirPods 3", "AirPods Max", "Galaxy Buds 3 Pro", "Sony WH-1000XM5"

            ],

            watch: [

                "Apple Watch Ultra 2", "Apple Watch Series 10", "Apple Watch Series 9", "Galaxy Watch 7", "Huawei Watch GT 4"

            ]

        }

    };



    let db = JSON.parse(localStorage.getItem('resell_db_v8')) || [];

    let logs = JSON.parse(localStorage.getItem('resell_logs_v8')) || [];

    let tempPhotos = [];

    let chartObj = null;



    function updateDatalists() {

        const type = document.getElementById('add-type').value;

        let html = `<datalist id="brands-dl">${GLOBAL_DATABASE.brands.map(b => `<option value="${b}">`).join('')}</datalist>`;

        html += `<datalist id="models-dl">${GLOBAL_DATABASE.models[type].map(m => `<option value="${m}">`).join('')}</datalist>`;

        document.getElementById('datalist-container').innerHTML = html;

    }



    function renderAddForm() {

        const type = document.getElementById('add-type').value;

        const div = document.getElementById('dynamic-form');

        let h = `<div class="form-group"><label>–ë—Ä–µ–Ω–¥</label><input id="b-brand" list="brands-dl" placeholder="Apple"></div>

                 <div class="form-group"><label>–ú–æ–¥–µ–ª—å</label><input id="b-model" list="models-dl" placeholder="iPhone 15"></div>

                 <div class="form-group"><label>–¶–≤–µ—Ç</label><input id="b-color" placeholder="Space Black"></div>`;

        if(type === 'phone') h += `<div class="form-group"><label>–ü–∞–º—è—Ç—å (–ì–±)</label><input type="number" id="b-memory" placeholder="256"></div>`;

        h += `<div class="form-group"><label>IMEI / S/N</label><input id="b-imei" placeholder="–ù–æ–º–µ—Ä"></div>`;

        div.innerHTML = h;

    }



    updateDatalists();

    renderAddForm();



    async function handlePhotos(input) {

        tempPhotos = [];

        const files = Array.from(input.files);

        const preview = document.getElementById('photo-preview-list');

        preview.innerHTML = "";

        for (let file of files) {

            const data = await readFile(file);

            tempPhotos.push(data);

            preview.innerHTML += `<img src="${data}" class="mini-preview">`;

        }

    }



    function readFile(file) {

        return new Promise(res => {

            const reader = new FileReader();

            reader.onload = (e) => {

                const img = new Image();

                img.src = e.target.result;

                img.onload = () => {

                    const canvas = document.createElement('canvas');

                    const ctx = canvas.getContext('2d');

                    canvas.width = 600; canvas.height = 600;

                    ctx.drawImage(img, 0, 0, 600, 600);

                    res(canvas.toDataURL('image/jpeg', 0.6));

                };

            };

            reader.readAsDataURL(file);

        });

    }



    function addItem() {

        const item = {

            id: Date.now(),

            type: document.getElementById('add-type').value,

            brand: document.getElementById('b-brand').value,

            model: document.getElementById('b-model').value,

            color: document.getElementById('b-color').value,

            imei: document.getElementById('b-imei').value,

            memory: document.getElementById('b-memory')?.value || '',

            buy: parseFloat(document.getElementById('inp-buy').value || 0),

            rep: parseFloat(document.getElementById('inp-repair').value || 0),

            comment: document.getElementById('inp-comment').value,

            photos: tempPhotos,

            status: 'stock',

            date: new Date().toISOString()

        };

        if(!item.brand || !item.buy) return alert("–ë—Ä–µ–Ω–¥ –∏ —Ü–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!");

        db.push(item);

        logs.unshift({t: `+ ${item.brand} ${item.model}`, d: new Date().toLocaleString(), type:'in'});

        save();

        location.relo
